function onStart(){this.scale=null,this.start_point_info=null,this.flipping=!1,this.start=new ui.startPageUI,this.startx=this.start.start.x,this.start.start.x=-999*this.start.start.width,Laya.loader.load(["res/atlas/home/0-tab.atlas","res/atlas/home/1-floor.atlas","res/atlas/home/2-wallpaper.atlas","res/atlas/home/3-sofa.atlas","res/atlas/home/4-cabinet.atlas","res/atlas/home/5-window.atlas","res/atlas/home/top.atlas","res/atlas/home/vscroll.atlas","home/1-floor/750_floor_img10.png","home/1-floor/750_floor_img2.png","home/1-floor/750_floor_img4.png","home/1-floor/750_floor_img6.png","home/1-floor/750_floor_img8.png","home/1-floor/750_floor_img1.png ","home/1-floor/750_floor_img3.png","home/1-floor/750_floor_img5.png","home/1-floor/750_floor_img7.png","home/1-floor/750_floor_img9.png","home/2-wallpaper/750_wall_img1.png","home/2-wallpaper/750_wall_img3.png","home/2-wallpaper/750_wall_img5.png","home/2-wallpaper/750_wall_img7.png","home/2-wallpaper/750_wall_img2.png","home/2-wallpaper/750_wall_img4.png","home/2-wallpaper/750_wall_img6.png","home/2-wallpaper/750_wall_img8.png","home/music/bg.mp3","res/atlas/comp.atlas"],null,Laya.Handler.create(this,onProgress,null,!1)),this.start.y=0,this.start.x=(Laya.stage.width-this.start.width)/2,Laya.stage.addChild(this.start),this.start.start.on(Laya.Event.CLICK,this,onStartClick),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,onScale),Laya.stage.on(Laya.Event.MOUSE_UP,this,onStopScale)}function onProgress(t){this.start.percent.text="内容加载中..."+(100*t).toFixed(2)+"%",t>=1&&(this.start.percent.visible=!1,this.start.start.x=this.startx,this.start.start.loadImage(this.start.start.skin),Laya.SoundManager.playMusic("home/music/bg.mp3",-1),Laya.SoundManager.setMusicVolume(.1))}function onStartClick(){onMain(),onTab(),Laya.stage.removeChildAt(0),showDragRegion()}function onMain(){this.main=new ui.mainPageUI,this.main.y=0,this.start.x=0,console.info(this.main.width,Laya.Browser.width),this.main.width=Laya.Browser.width,this.main.wall.loadImage("home/top/wall_bg.png",0,0,this.main.wall.width,this.main.wall.height),this.main.floor.loadImage("home/top/floot_bg.png",0,0,this.main.floor.width,this.main.floor.height),this.main.home.on(Laya.Event.CLICK,this,onClickMain),Laya.stage.addChild(this.main),mainhome=this.main.home}function onTab(){this.ts=new ui.tabSelectUI,this.ts.scaleX=Laya.stage.width/950,this.ts.scaleY=this.ts.scaleX,this.ts.x=(Laya.stage.width-this.ts.width)/2,this.ts_proration=this.ts.width/this.ts.height,this.ts.x=0,console.info("==",this.ts.width,Laya.Browser.width,this.ts.height),this.ts.height=this.ts.width/this.ts_proration,this.ts.y=Laya.stage.height-this.ts.height*this.ts.scaleY,Laya.stage.addChild(ts),this.ts.viewStack.on(Laya.Event.CLICK,this,onStackClick),this.ts.tab.selectHandler=new Laya.Handler(this,onSelect);for(var t in this.ts.viewStack._childs){var a=this.ts.viewStack._childs[t];for(var e in a._childs[0]._childs){a._childs[0]._childs[e].on(Laya.Event.CLICK,this,onImageClick)}}onPreview()}function onPreview(){this.preview=new Laya.Button,this.preview.skin="home/top/photo_icon.png",this.preview.x=Laya.stage.width-105,this.preview.y=Laya.stage.height-this.ts.height*this.ts.scaleY-105,this.preview.stateNum=1,this.preview.width=82,this.preview.height=82,Laya.stage.addChild(this.preview),this.preview.on(Laya.Event.CLICK,this,onPreviewClick)}function onPreviewClick(t){console.info("preview"),clearIco(),this.ts.visible=!1,this.preview.visible=!1;var a=Laya.stage.drawToCanvas(Laya.stage.width,Laya.stage.height-this.ts.height*this.ts.scaleY,0,0).getCanvas(),e=new Image;e.src=a.toDataURL(),e.width=Laya.Browser.clientWidth,e.style.position="fixed",e.style.left=0,e.style.top=0,e.style.zIndex=18,document.getElementsByTagName("body")[0].appendChild(e),showFooter(),t.stopPropagation()}function showFooter(){}function onStackClick(t){t.stopPropagation()}function onImageClick(t){if(console.info(t,t.target instanceof Laya.Image),t.target instanceof Laya.Image){var a=t.target._skin;console.info(a);var e=a.split("/");e[e.length-1];e[e.length-1]="750_"+e[e.length-1].substr(4);var i=e.join("/");switch(e[e.length-2]){case"1-floor":this.main.floor.graphics.clear(),this.main.floor.loadImage(i,0,0,this.main.floor.width,this.main.floor.height);break;case"2-wallpaper":this.main.wall.graphics.clear(),this.main.wall.loadImage(i,0,0,this.main.wall.width,this.main.wall.height);break;default:insertSprite(i)}}}function onSelect(t){this.ts.viewStack.selectedIndex=t}function insertSprite(t){clearIco(null);var a=new Laya.Sprite,e=new Laya.Image;e.loadImage(t,0,0,0,0,Laya.Handler.create(this,function(t){e.pivotX=e.width/2,e.pivotY=e.height/2,a.pos(this.main.wall.width/2-t.width/2,this.main.wall.height/2-t.height/2),e.size(e.width,e.height),a.addChildAt(e,0),a.addChildAt(_drawLineBox(e),1);var i=new Laya.Image;i.loadImage("home/top/delete.png",0,0,40,40),i.pos(e.width*Math.abs(e.scaleX)/-2-5,e.height*Math.abs(e.scaleY)/-2-5),i.on(Laya.Event.MOUSE_DOWN,this,onDelete),i.pivot(20,20),i.alpha=.6,a.addChildAt(i,2);var s=new Laya.Image;s.loadImage("home/top/scale.png",0,0,40,40),s.pos(e.width*Math.abs(e.scaleX)/2+5,e.height*Math.abs(e.scaleY)/-2-5),s.on(Laya.Event.MOUSE_MOVE,this,onStartScale),s.on(Laya.Event.MOUSE_UP,this,onStopScale),s.alpha=.6,s.pivot(20,20),a.addChildAt(s,3);var o=new Laya.Image;o.loadImage("home/top/flipping.png",0,0,40,40),o.pos(e.width*Math.abs(e.scaleX)/-2-5,e.height*Math.abs(e.scaleY)/2+5),o.on(Laya.Event.MOUSE_DOWN,this,onFlipping),o.alpha=.6,o.pivot(20,20),a.addChildAt(o,4),a.zOrder=getMaxOrder(),this.main.home.addChild(a),e.on(Laya.Event.MOUSE_DOWN,this,onStartDrag),a.on(Laya.Event.MOUSE_UP,this,onStopDrag)}))}function _drawLineBox(t){var a=new Laya.Sprite;return a.pos(t.width*Math.abs(t.scaleX)/-2,t.height*Math.abs(t.scaleY)/-2),a.graphics.drawLine(-10,-10,t.width*t.scaleX+10,-10,"#efefef",1),a.graphics.drawLine(t.width*t.scaleX+10,-10,t.width*t.scaleX+10,t.height*t.scaleY+10,"#efefef",1),a.graphics.drawLine(t.width*t.scaleX+10,t.height*t.scaleY+10,-10,t.height*t.scaleY+10,"#efefef",1),a.graphics.drawLine(-10,t.height*t.scaleY+10,-10,-10,"#efefef",1),a.alpha=.6,a}function clearIco(t){for(var a in this.main.home._childs){var e=this.main.home._childs[a];for(var i in e._childs)i>0&&(e._childs[i].visible=!1)}null!=t&&t.stopPropagation()}function onDelete(t){console.info(t),t.target.parent.destroy(),t.stopPropagation()}function onFlipping(t){t.target.parent._childs[0].scaleX*=-1,this.flipping=!0,t.stopPropagation()}function onStopFlipping(t){this.flipping=!1,t.stopPropagation()}function onClickMain(t){console.info(t),ocm=t,t.target&&t.target.parent&&t.target.parent instanceof mainPageUI&&clearIco(),t.stopPropagation()}function onStartScale(t){if(null==this.scale){console.info(t,t.target.parent.scaleX);var a=100/(t.target.parent._childs[0].width*t.target.parent.scaleX);console.info("====",a),t.target.parent.scaleX*=1+a,t.target.parent.scaleY*=1+a,this.scale=t.target,resetIcoPos(t.target)}t.stopPropagation()}function onStopScale(t){console.info(t),null!=this.scale&&(this.scale=null,this.start_point_info=null),t.stopPropagation()}function onScale(t){if(null!=this.scale){if(void 0!==t.nativeEvent.changedTouches)a=t.nativeEvent.changedTouches[0];else var a=t.nativeEvent;if(null==this.start_point_info)this.start_point_info=a;else{var e=a,i=e.pageY-this.start_point_info.pageY;0==i&&(i=this.start_point_info.pageX-e.pageX),i<0?(this.scale.parent.scaleX+=.02,this.scale.parent.scaleY+=.02):i>0&&this.scale.parent.scaleX>.5&&(this.scale.parent.scaleX-=.02,this.scale.parent.scaleY-=.02),resetIcoPos(this.scale),this.start_point_info=e}}}function resetIcoPos(t){var a=40/(t.parent._childs[2].width*t.parent.scaleX);t.parent._childs[2].scaleX=a,t.parent._childs[2].scaleY=a,t.parent._childs[3].scaleX=a,t.parent._childs[3].scaleY=a,t.parent._childs[4].scaleX=a,t.parent._childs[4].scaleY=a}function onClickStop(t){this.start_point_info=null,t.stopPropagation()}function showDragRegion(){this.main.home.width,this.main.home.height}function onStartDrag(t){if(console.info(t),null==this.scale){clearIco();for(var a in t.target.parent._childs)t.target.parent._childs[a].visible=!0;t.target.parent.zOrder=getMaxOrder(),Laya.Tween.to(t.target.parent,{scaleX:1.05*t.target.parent.scaleX,scaleY:1.05*t.target.parent.scaleY},400,Laya.Ease.elasticInOut,null,0),t.target.parent.startDrag(null,!0,100),t.stopPropagation()}else t.stopPropagation()}function getMaxOrder(){var t=0;for(var a in this.main.home._childs)this.main.home._childs[a].zOrder>t&&(t=this.main.home._childs[a].zOrder);return t+1}function onStopDrag(t){console.info(t),null==this.scale?this.flipping?onStopFlipping(t):(Laya.Tween.to(t.target.parent,{scaleX:t.target.parent.scaleX/1.05,scaleY:t.target.parent.scaleY/1.05},400,Laya.Ease.elasticInOut,null,0),t.stopPropagation()):onStopScale(t)}function onMouseOut(t){null==this.scale||onStopScale(t)}function showFooter(){document.getElementById("footer").style.display="block"}function hideFooter(){document.getElementById("footer").style.display="none"}function showOpen(){Zepto("#open .main").show(),Zepto("#open .main-quan").hide(),Zepto("#open").fadeIn()}function hideOpen(){document.getElementById("open").style.display="none"}function showQuan(){Zepto("#open .main").hide(),Zepto("#open .main-quan").css("display","block")}var WebGL=laya.webgl.WebGL;Laya.init(750,1334,WebGL),Laya.stage.bgColor="#fff",Laya.stage.screenMode=Laya.Stage.SCREEN_NONE,Laya.stage.scaleMode=Laya.Stage.SCALE_FIXED_HEIGHT,Laya.loader.load(["res/atlas/home/0-home.atlas"],Laya.Handler.create(this,onStart));var dragRegion;Zepto(function(t){var a=t(window).width(),e=.85*a,i=(a-e)/2,s=(t(window).height()-1334*e/750)/2;Zepto("#open .main img").css({left:i,marginTop:s})});